<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

	<title>nakajima/fixjour @ GitHub</title>
	
	<style type="text/css">
		body {
  		margin-top: 1.0em;
  		background-color: #fff;
		  font-family: "helvetica"; 
  		color: #000000;
    }
    #container {
      margin: 0 auto;
      width: 700px;
    }
		h1 { font-size: 3.8em; color: #ff5500; margin-bottom: 3px; }
		h1 .small { font-size: 0.4em; }
		h1 a { text-decoration: none }
		h2 { font-size: 1.5em; color: #ff5500; }
    h3 { color: #ff5500; }
    a { color: #ff5500; }
    .description { font-size: 1.2em; margin-bottom: 30px; margin-top: 30px; font-style: italic;}
    .download { float: right; }
		pre {
		  font-family: Bitstream Vera Sans Mono;
		  background: #fafafa; color: #222; padding: 10px; border: 1px solid #eee;
		}
		code {
		  font-family: Bitstream Vera Sans Mono;
		  background: #fafafa; color: #222; border: 1px solid #eee;
		}
    hr { border: 0; width: 80%; border-bottom: 1px solid #aaa}
    .footer { text-align:center; padding-top:30px; font-style: italic; }
	</style>
	
</head>

<body>
  <a href="http://github.com/nakajima/fixjour"><img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub" /></a>
  
  <div id="container">

    <div class="download">
      <a href="http://github.com/nakajima/fixjour/zipball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/zip.png"></a>
      <a href="http://github.com/nakajima/fixjour/tarball/master">
        <img border="0" width="90" src="http://github.com/images/modules/download/tar.png"></a>
    </div>
      
    <h1><a href="http://github.com/nakajima/fixjour">fixjour</a> 
      <span class="small">by <a href="http://github.com/nakajima">nakajima</a></small></h1>

    <h4>
      Word to your object mother.
    </h4>

    <p>
      Another fixture replacement. Gets you some methods (<code>new_*</code>, <code>create_*</code> and
      <code>valid_*_attributes</code>) and some confidence.
    </p>

    <h2>Liberation through constraints.</h2>

    <h3>One builder per model</h3>

    <p>
      If you try to define a builder more than once per model, you'll
      run into a <code>Fixjour::RedundantBuilder</code> error. One builder per
      model decreases confusion.
    </p>
    

    <h3>No redundant object creation methods</h3>
    
    <p>
      If you try to define a method that's already been defined by
      a Fixjour builder, you'll run into a <code>Fixjour::RedundantBuilder</code>
      error. If you find the need to alter the behavior of a builder
      for a particular set of tests, you should just wrap the creation
      methods defined by Fixjour, preferably with a name that describes
      how the new method is different from the Fixjour method.
    </p>

    <h3>Processing the overrides hash is bad</h3>

    <p>
      If you want to mess with the overrides hash that can be passed
      into any of the creation methods, you must use the <code>process</code>
      method (see below). To enforce this, the <code>delete</code> method is actually
      private for the overrides hash.
    </p>

    <h2>Usage</h2>

    <p>With this setup:</p>

<pre>
Fixjour do
  define_builder(Person) do |klass, overrides|
    klass.new(:name => 'Pat', :age => 22)
  end
end

include Fixjour
</pre>

    <p>You get:</p>

    <h3><code>new_person(overrides={})</code></h3>

    <p>
      The <code>new_person</code> method basically just returns the result
      of your builder block, which should *always return an unsaved
      instance of the model class*. You can pass it overrides in a
      hash like so: <code>new_person(:name => nil)</code>.
    </p>


    <h3><code>create_person(overrides={})</code></h3>
    
    <p>
      The <code>create_person</code> method calls <code>new_person</code>, passing in any
      overrides you pass it, calls <code>save!</code> on the result, and returns
      the saved object.
    </p>

    <h3><code>valid_person_attributes(overrides={})</code></h3>

    <p>
      The <code>valid_person_attributes</code> returns a hash of valid person
      attributes that are derived from the <code>new_person</code> method, and
      ideal for things like testing controllers. It can also take
      attribute override options like so: <code>valid_person_attributes(:name => nil)</code>.
    </p>

    <h2>Builders</h2>

    <p>
      You specify builder sets for your ActiveRecord models in a
      <code>Fixjour</code> block using the <code>define_builder</code> helper, which can
      be used in one of two ways:
    </p>
    
    <h3>Using a builder block</h3>

    <p>
      Pass <code>define_builder</code> a model class for which you want a new set
      of creation methods, and a block which returns a new valid
      model object. The block will be passed two arguments: a proxy
      object for your class, and an overrides hash. If you call <code>new</code>
      on the class proxy, it will return a new instance of the class,
      with whatever attributes you specify as defaults. It will also
      automatically merge any override options in all of the methods
      generated by Fixjour.
    </p>
    

    <p>Example:</p>

<pre>
define_builder(Person) do |klass, overrides|
  klass.new(:name => "Pat", :age => 22)
end
</pre>

    <p>
      If you want to process an option in the overrides hash, you can use
      the <code>process</code> method:
    </p>

<pre>
define_builder(Person) do |klass, overrides|
  overrides.process(:child) do |is_child|
    overrides[:age] = 14 if is_child
  end

  klass.new(:name => "Pat", :age => 22)
end

# the default
person = new_person
person.age # => 22

# using the override
person = new_person(:child => true)
person.age  # => 14
</pre>

    <p>In the above example, the <code>:child</code> key will be deleted from the <code>overrides</code>
    hash and made available as the <code>is_child</code> block argument where you can handle
    things accordingly.</p>
    
    <p>
      <strong>Note:</strong> The <code>delete</code> method is private on the overrides hash passed into the
      builder block. This is meant to encourage you to only use the <code>process</code> method
      instead. Why? First, because processing the overrides hash is a smell. Deal
      with it. Second, using the <code>process</code> method provides some indication to readers
      that you're screwing with the overrides hash, and that's a good thing.
    </p>
    

    <h3><code>attr_protected</code> fields</h3>

    <p>If you have fields that cannot be mass-assigned, use the <code>protected</code> helper:</p>

<pre>
define_builder(Article) do |klass, overrides|
  klass.protected :author
  klass.new :title => "The title", :body => "good", :author => new_user
end  
</pre>

    <p>If you use the <code>protected</code> helper to declare <code>attr_protected</code> fields, you can
    then treat them the same as any other field in your test methods.</p>

    <h3>With Associations</h3>

    <p>To specify an associated object, you can call that object's <code>new_*</code> method:</p>

    <pre>
Fixjour do
  define_builder(Post) do |klass, overrides|
    klass.new(:name => 'a post', :body => 'texted')
  end

  define_builder(Comment) do |klass, overrides|
    klass.new(:body => 'Oh ok!', :post => new_post)
  end
end

include Fixjour

new_comment.post.name # => 'a post'
</pre>

    <p>Note that it's never a good idea to use a <code>create_*</code> method in a
    build block.</p>

    <h3>Verifying your setups</h3>

    <p>Fixjour requires more work on your part, so it also includes a way
    to verify that your creation methods are behaving the way they should.
    Call <code>Fixjour.verify!</code> to ensure the following things:</p>

    <ol>
      <li>Creation methods are returning valid objects by default.</li>
      <li><code>new_*</code> methods are returning new records.</li>
      <li><code>new_*</code> and <code>create_*</code> methods return instances of the correct class.</li>
    </ol>

    <h3>Recommended usage with RSpec and Cucumber</h3>

    <p>If you want to use Fixjour with RSpec and Cucumber you probably want to avoid adding the builder methods onto Object directly.  To do this you should first create a file where your Fixjour builder definitions can live.  Say for example you put it at spec/fixjour_builders.rb.  To take advantage of these builders from RSpec use the following code in your spec_helper.rb:</p>

<pre>require File.expand_path(File.dirname(__FILE__) + "/fixjour_builders.rb")

Spec::Runner.configure do |config|
  # Add the builder methods to your ExampleGroups without polluting Object
  config.include(Fixjour) 
  ...
end</pre>

    <p>To use the same builders in Cucumber you simply need to include Fixjour into your World object
    from features/support/env.rb:</p>

    <pre>
require File.expand_path(File.dirname(__FILE__) +'/../../spec/fixjour_builders.rb')
World { |world| world.extend(Fixjour) }</pre>

    <p>Be sure to do this after you define your World object.  So, if you are using Rails you should
    include Fixjour after you require 'cucumber/rails/world'.</p>

    <h3>Contributors</h3>

    <ul>
      <li><a href="http://github.com/pat-maddox">Pat Maddox</a> - Sparked the original idea and fixed my bugs</li>
      <li><a href="http://github.com/bmabey">Ben Mabey</a> - Added docs and fixed my bugs</li>
      <li><a href="http://github.com/mdalessio">Mike Dalessio</a> - Argued with me over syntax (in a good way) and fixed my bugs</li>
      <li><a href="http://github.com/quirkey">Aaron Quint</a> - Pointed out valid attrs problem and fixed my bugs</li>
    </ul>

    <h3><a href="http://ci.patnakajima.com/fixjour">View the CI build.</a></h3>

    <p>I've talked to smart people who like these instead:</p>

    <h4><a href="http://github.com/smtlaissezfaire/fixturereplacement/tree/master">fixturereplacement</a></h4>
    <h4><a href="http://github.com/thoughtbot/factory_girl/tree">factory girl</a></h4>

</p><h2>Dependencies</h2>
<p>activerecord</p>
<h2>Install</h2>
<p>gem install fixjour</p>
<h2>License</h2>
<pre>Copyright (c) 2009 Pat Nakajima

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.</pre>
<h2>Contact</h2>
<p>Pat Nakajima (patnakajima@gmail.com)
<br/>      </p>


    <h2>Download</h2>
    <p>
      You can download this project in either
      <a href="http://github.com/nakajima/fixjour/zipball/master">zip</a> or
      <a href="http://github.com/nakajima/fixjour/tarball/master">tar</a> formats.
    </p>
    <p>You can also clone the project with <a href="http://git-scm.com">Git</a>
      by running:
      <pre>$ git clone git://github.com/nakajima/fixjour</pre>
    </p>
      
    <div class="footer">
      get the source code on GitHub : <a href="http://github.com/nakajima/fixjour">nakajima/fixjour</a>
    </div>
    
  </div>

  
</body>
</html>
